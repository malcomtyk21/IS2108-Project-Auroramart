{% extends 'adminpanel/base_admin.html' %}
{% load static %}

{% block title %}Customer's Orders - AuroraMart Admin{% endblock %}

{% block navbar %}
{% include 'adminpanel/navbar.html' %}
{% endblock %}

{% block extra_head %}
<link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<style>
    .status {
        padding: 4px 10px;
        border-radius: 12px;
        font-weight: 600;
    }

    .status.pending {
        background: rgba(255, 165, 0, .15);
        color: #d97706;
    }

    .status.shipped {
        background: rgba(59, 130, 246, .15);
        color: #2563eb;
    }

    .status.delivered {
        background: rgba(16, 185, 129, .15);
        color: #059669;
    }

    .status.cancelled {
        background: rgba(239, 68, 68, .15);
        color: #dc2626;
    }

    .order-card {
        background: #fff;
        border: 1px solid #e5e7eb;
        border-radius: 14px;
        margin-bottom: 16px;
    }

    .order-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        border-bottom: 1px solid #e5e7eb;
    }

    .order-meta {
        font-size: 13px;
        color: #6b7280;
    }

    .order-body {
        padding: 12px 16px;
    }
</style>
{% endblock %}

{% block main_content %}
<div class="header-container">
    <div class="header">
        <div class="header-left">
            <h1>Orders for {% if target_user.username %}{{ target_user.username }}{% else %}{{
                target_user.username }}{% endif %}</h1>
            <p>{{ target_user.email }}</p>
        </div>
    </div>
</div>

{% if messages %}
{% for message in messages %}
<script>alert("{{ message|escapejs }}");</script>
{% endfor %}
{% endif %}

<div class="container">
    {% if orders %}
    {% for o in orders %}
    <div class="order-card">
        <div class="order-head">
            <div>
                <div style="font-weight:700;">Order #{{ o.id }}</div>
                <div class="order-meta">Placed {{ o.created_at|date:"M. d, Y, g:i a" }}</div>
            </div>
            <div>
                <span class="status {{ o.status }}">{{ o.status|title }}</span>
                <span style="margin-left:12px; font-weight:700;">Total: ${{ o.total_amount|floatformat:2 }}</span>
            </div>
        </div>
        <div class="order-body">
            <table width="100%">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Unit Price</th>
                        <th>Qty</th>
                        <th>Line Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for it in o.items %}
                    <tr>
                        <td>{{ it.name }}</td>
                        <td>${{ it.unit|floatformat:2 }}</td>
                        <td>{{ it.qty }}</td>
                        <td>${{ it.total|floatformat:2 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div style="margin-top:10px;">
                <button class="btn-add" type="submit"><a href="{% url 'order_view' o.id %}"><span
                            class="material-symbols-outlined">assignment</span></a></button>
                <button class="btn-add" type="submit"><a href="{% url 'order_edit' o.id %}"><span
                            class="material-symbols-outlined">edit</span></a></button>
            </div>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <div class="order-card" style="padding:16px;">No orders found for this customer.</div>
    {% endif %}
</div>
{% endblock %}