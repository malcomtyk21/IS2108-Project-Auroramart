{% extends 'adminpanel/base_admin.html' %}

{% block title %}Dashboard - AuroraMart Admin{% endblock %}

{% block navbar %}
{% include 'adminpanel/navbar.html' %}
{% endblock %}

{% block main_content %}
<div class="dash-wrap">
    <h1 style="padding: 0px 0px 20px 0px;">Dashboard</h1>

    <form method="get" style="margin:0 0 24px; display:flex; flex-wrap:wrap; gap:12px; align-items:flex-end;">
        <div class="date-range">
            <label style="font-size:12px; font-weight:600;">Start Date</label>
            <input type="date" name="start" value="{{ filter_start }}" />
        </div>
        <div class="date-range">
            <label style="font-size:12px; font-weight:600;">End Date</label>
            <input type="date" name="end" value="{{ filter_end }}" />
        </div>
        <div style="display:flex; gap:8px;">
            <button type="submit">Apply Filters</button>
            <a href="?{% if request.GET.page_size %}page_size={{ request.GET.page_size }}{% endif %}">
                <button type="button">Clear All</button>
            </a>
        </div>
        
    </form>

    <div style="margin-bottom: 20px;">
    {% if range_active %}
    <span style="font-size:12px; color:#6b7280;">Showing data from {{ filter_start }} to {{ filter_end }}</span>
    {% else %}
    <span style="font-size:12px; color:#6b7280;">Showing current year</span>
    {% endif %}
    </div>

    <div class="kpi-cards">
        <div class="total-revenue">
            <div class="year">Total Revenue ({{ kpi_year }})</div>
            <div class="amount">{{ kpi_total_revenue }}</div>
            <div class="note">Aggregated from orders this year</div>
        </div>
        <div class="total-orders">
            <div class="year">Total Orders ({{ kpi_year }})</div>
            <div class="amount">{{ kpi_total_orders }}</div>
            <div class="note">Orders placed this year</div>
        </div>
        <div class="total-customers">
            <div class="year">Total Customers</div>
            <div class="amount">{{ kpi_total_customers }}</div>
            <div class="note">All registered customers</div>
        </div>
    </div>

    <div class="revenue-card">
        <div class="revenue-head">
            <div>
                <p class="revenue-title">Monthly Revenue</p>
            </div>
        </div>

        <div class="chart-host">
            {{ graph_html|safe }}
        </div>
    </div>
    <div class="container">
        <h2>Top 10 Products by Sales ({{ kpi_year }})</h2>
        <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse:collapse; font-size:13px;">
                <thead>
                    <tr>
                        <th>Top</th>
                        <th>Product</th>
                        <th>Qty Sold</th>
                        <th>Revenue ($)</th>
                    </tr>
                </thead>
                <tbody>
                {% for p in top_products %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ p.product__product_name }}</td>
                        <td>{{ p.total_quantity }}</td>
                        <td>${{ p.total_revenue|floatformat:2 }}</td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="4">No product sales found.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}